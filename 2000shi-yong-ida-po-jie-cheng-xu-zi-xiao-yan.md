#使用 IDA 破解程序自校验
##概述
本文记录破解 CCProxy 自校验的过程。背景是，公司配备了两台电脑，一台办公机可访问外网，一台开发机只能访问内网，这两台电脑网络上是通的。所以在办公机上建网络代理，让开发机去使用，这样开发机就可以访问外网了。
为后续称呼方便，称提供代理服务的办公机为 S，使用代理服务的开发机为 C。

#问题记录
##开发机无外网
设置 C 上的网络代理信息为：S 的局域网 IP 和开启代理的端口。但 C 仍无外网访问。经过排查，发现 C 的 request 到达了 S ，但是 S 没有回包。因此我们可以猜测到是因为 S 没有收到外网的 response 因此也就暂时没有给 C response。为什么 S 不能访问外网呢？突然想到，S 浏览器上设置过公司的网络代理服务器。所以直接把 S 的代理服务器信息设置到 S 的 CCProxy 上。试验成功，S 收到了 response 并且把这个 response 给到了 C。代理成功。这个概念就是多级代理。

##CCProxy破解
公司的网络策略本来就是禁止开发机 C 访问外网的。后面公司通过流量监控，发现 S 上名为 "CCProxy" 的进程流量很大，而这个进程名一看就知道是干啥的，所以被警告了。而有时我们的开发机 C 上确实需要访问外网，比如代码编辑器更新插件，下载文件什么的。所以萌生了将 CCProxy 这个程序改名再运行的想法。
然而将 CCProxy.exe 改名为 firefox.exe 后，发现进程启动不了，没有任何错误信息。这就很奇怪了。一一尝试 CCProxy 安装目录下的配置，mui 文件，均不得解决。于是，我们猜测，是不是 CCProxy.exe 程序中对“本文件”的文件名进行了校验？
这个想法很容易验证：直接使用 exe 编辑器，将 CCProxy.exe 文件中的字符串 "CCProxy" 替换为 firefox。确实可以打开了！
然而事情并没有结束，虽然成功运行替换文件名之后的 firefox.exe，但是程序无法实现代码，因为此时程序的流量监控里面没有打印任何信息出来。我们去看它的运行日志，打开后看到有这样的报错：

